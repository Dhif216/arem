import{j as e}from"./index-Bbp5hefe.js";import{r as n,e as P}from"./react-vendor-BgZu1yuc.js";import{a as w,b as A,u as D,c as k,d as _,e as M,f as U,g as q}from"./productsService-BRD0MKqH.js";import"./i18n-vendor-DSlEIxXL.js";const $=()=>{const[u,F]=n.useState([]),[g,m]=n.useState(!0),[c,j]=n.useState(null),[d,h]=n.useState(!1),[p,v]=n.useState(!1),[x,f]=n.useState(!1),[o,t]=n.useState(null),[y,b]=n.useState(""),S=P(),[r,i]=n.useState({nameFr:"",nameTn:"",descriptionFr:"",descriptionTn:"",price:"",category:"honeyed",image:"",featured:!1});n.useEffect(()=>{w(q).catch(s=>{console.warn("Anonymous auth failed (may be disabled):",s)}),m(!0),b("");try{const s=A(a=>{console.log("Received products from Firestore:",a.length),F(a),m(!1)});return()=>{s()}}catch(s){console.error("Failed to subscribe to products:",s),b("Impossible de charger les produits. VÃ©rifiez la console."),m(!1)}},[]);const T=()=>{localStorage.removeItem("adminAuth"),localStorage.removeItem("adminUsername"),S("/admin/login")},C=async s=>{s.preventDefault(),v(!0),t(null);const a={slug:k(r.nameFr||`produit-${Date.now()}`),category:r.category,price:parseFloat(r.price),image:r.image,name_fr:r.nameFr,name_tn:r.nameTn,desc_fr:r.descriptionFr,desc_tn:r.descriptionTn,featured:r.featured};try{c?.id?(await _(c.id,a),t({type:"success",text:"Produit mis Ã  jour avec succÃ¨s!"})):(await M(a),t({type:"success",text:"Produit ajoutÃ© avec succÃ¨s!"})),setTimeout(()=>{N(),t(null)},2e3)}catch{t({type:"error",text:"Erreur lors de l'enregistrement du produit"})}finally{v(!1)}},I=s=>{j(s),i({nameFr:s.name_fr,nameTn:s.name_tn,descriptionFr:s.desc_fr,descriptionTn:s.desc_tn,price:s.price.toString(),category:s.category,image:s.image,featured:s.featured||!1}),h(!0)},E=async s=>{if(s&&confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce produit? Cette action est dÃ©finitive.")){t(null);try{await U(s),t({type:"success",text:"Produit supprimÃ© avec succÃ¨s!"}),setTimeout(()=>t(null),3e3)}catch{t({type:"error",text:"Erreur lors de la suppression du produit"})}}},N=()=>{i({nameFr:"",nameTn:"",descriptionFr:"",descriptionTn:"",price:"",category:"honeyed",image:"",featured:!1}),j(null),h(!1)};return e.jsxs("div",{className:"admin-dashboard",children:[e.jsx("header",{className:"admin-header",children:e.jsxs("div",{className:"admin-header-content",children:[e.jsx("h1",{children:"ğŸ° Admin Dashboard"}),e.jsxs("div",{className:"admin-user-info",children:[e.jsxs("span",{children:["ğŸ‘¤ ",localStorage.getItem("adminUsername")]}),e.jsx("button",{onClick:T,className:"logout-btn",children:"DÃ©connexion"})]})]})}),e.jsxs("div",{className:"admin-content",children:[e.jsxs("div",{className:"admin-actions",children:[e.jsx("button",{onClick:()=>h(!d),className:"add-product-btn",children:d?"âœ– Annuler":"â• Ajouter un produit"}),e.jsxs("div",{className:"product-count",children:["Total: ",e.jsx("strong",{children:u.length})," produits"]})]}),d&&e.jsxs("div",{className:"product-form-container",children:[e.jsx("h2",{children:c?"Modifier le produit":"Nouveau produit"}),o&&e.jsx("div",{className:`status-message ${o.type}`,children:o.text}),e.jsxs("form",{onSubmit:C,className:"product-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nom (FranÃ§ais) *"}),e.jsx("input",{type:"text",value:r.nameFr,onChange:s=>i({...r,nameFr:s.target.value}),required:!0,placeholder:"Ex: Makroud"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nom (Arabe) *"}),e.jsx("input",{type:"text",value:r.nameTn,onChange:s=>i({...r,nameTn:s.target.value}),required:!0,placeholder:"Ex: Ù…Ù‚Ø±ÙˆØ¶",dir:"rtl"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description (FranÃ§ais) *"}),e.jsx("textarea",{value:r.descriptionFr,onChange:s=>i({...r,descriptionFr:s.target.value}),required:!0,rows:3,placeholder:"Description en franÃ§ais"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description (Arabe) *"}),e.jsx("textarea",{value:r.descriptionTn,onChange:s=>i({...r,descriptionTn:s.target.value}),required:!0,rows:3,placeholder:"Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",dir:"rtl"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Prix (TND) *"}),e.jsx("input",{type:"number",step:"0.01",value:r.price,onChange:s=>i({...r,price:s.target.value}),required:!0,placeholder:"Ex: 12.50"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"CatÃ©gorie *"}),e.jsxs("select",{value:r.category,onChange:s=>i({...r,category:s.target.value}),required:!0,children:[e.jsx("option",{value:"honeyed",children:"Honeyed"}),e.jsx("option",{value:"dry",children:"Dry"}),e.jsx("option",{value:"seasonal",children:"Seasonal"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Image du produit *"}),e.jsxs("div",{className:"image-upload-container",children:[e.jsxs("div",{className:"upload-options",children:[e.jsx("button",{type:"button",className:"upload-tab",onClick:()=>document.getElementById("imageFileInput")?.click(),disabled:x,children:x?"â³ TÃ©lÃ©versement...":"ğŸ“ TÃ©lÃ©charger depuis l'appareil"}),e.jsx("span",{style:{margin:"0 10px",color:"#999"},children:"ou"}),e.jsx("input",{type:"text",value:r.image,onChange:s=>i({...r,image:s.target.value}),placeholder:"Entrer une URL d'image",style:{flex:1}})]}),e.jsx("input",{id:"imageFileInput",type:"file",accept:"image/*",style:{display:"none"},onChange:async s=>{const a=s.target.files?.[0];if(a){if(!a.type.startsWith("image/")){t({type:"error",text:"Veuillez sÃ©lectionner un fichier image valide"});return}if(a.size>5*1024*1024){t({type:"error",text:"Image trop grande. Maximum 5MB."});return}f(!0),t(null);try{console.log("Uploading image:",a.name,a.type,a.size);const l=await D(a);console.log("Image uploaded, URL:",l),i({...r,image:l}),t({type:"success",text:"Image tÃ©lÃ©versÃ©e avec succÃ¨s!"}),setTimeout(()=>t(null),3e3)}catch(l){console.error("Upload error:",l),t({type:"error",text:`Erreur: ${l instanceof Error?l.message:"TÃ©lÃ©versement Ã©chouÃ©"}`})}finally{f(!1),s.target.value=""}}}}),r.image&&e.jsx("div",{className:"image-preview",children:e.jsx("img",{src:r.image,alt:"Preview",onError:s=>{s.target.src="https://via.placeholder.com/150?text=Image+Error"}})})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.featured,onChange:s=>i({...r,featured:s.target.checked})}),"Produit vedette"]})}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"submit-btn",disabled:p||x,children:p?"â³ Enregistrement...":c?"ğŸ’¾ Mettre Ã  jour":"â• Ajouter"}),e.jsx("button",{type:"button",onClick:N,className:"cancel-btn",disabled:p,children:"Annuler"})]})]})]}),e.jsxs("div",{className:"products-list",children:[e.jsx("h2",{children:"Liste des produits"}),y&&e.jsx("div",{className:"status-message error",children:y}),o&&!d&&e.jsx("div",{className:`status-message ${o.type}`,children:o.text}),g&&e.jsx("div",{className:"loading-indicator",children:"Chargement des produits..."}),e.jsx("div",{className:"products-table-container",children:e.jsxs("table",{className:"products-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"CatÃ©gorie"}),e.jsx("th",{children:"Prix"}),e.jsx("th",{children:"Vedette"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:!g&&u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"no-products",children:"Aucun produit. Ajoutez votre premier produit!"})}):u.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("img",{src:s.image,alt:s.name_fr,className:"product-thumb"})}),e.jsx("td",{children:e.jsxs("div",{className:"product-names",children:[e.jsx("div",{children:s.name_fr}),e.jsx("div",{className:"product-name-ar",children:s.name_tn})]})}),e.jsx("td",{children:e.jsx("span",{className:"category-badge",children:s.category})}),e.jsx("td",{children:e.jsxs("strong",{children:[s.price.toFixed(2)," TND"]})}),e.jsx("td",{children:s.featured?"â­":"-"}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>I(s),className:"edit-btn",title:"Modifier",children:"âœï¸"}),e.jsx("button",{onClick:()=>E(s.id),className:"delete-btn",title:"Supprimer",children:"ğŸ—‘ï¸"})]})})]},s.id))})]})})]})]})]})};export{$ as default};
